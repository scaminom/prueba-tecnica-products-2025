@if (loading()) {
<div class="table-container">
  <div class="table-wrapper">
    <table class="products-table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Nombre del producto</th>
          <th>
            Descripción
            <app-tooltip text="Descripción del producto financiero" />
          </th>
          <th>
            Fecha de liberación
            <app-tooltip text="Fecha de lanzamiento del producto al mercado" />
          </th>
          <th>
            Fecha de revisión
            <app-tooltip text="Fecha de reestructuración del producto" />
          </th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (_ of [1,2,3,4,5]; track $index) {
        <tr>
          <td data-label="Logo"><div class="skeleton skeleton-avatar"></div></td>
          <td data-label="Nombre"><div class="skeleton skeleton-text"></div></td>
          <td data-label="Descripción"><div class="skeleton skeleton-text long"></div></td>
          <td data-label="F. liberación"><div class="skeleton skeleton-text sm"></div></td>
          <td data-label="F. revisión"><div class="skeleton skeleton-text sm"></div></td>
          <td><div class="skeleton skeleton-chip"></div></td>
        </tr>
        }
      </tbody>
    </table>
  </div>
</div>
} @else if (error()) {
<div class="error-container">
  <div class="error-message">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
      <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2" />
      <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2" />
      <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2" />
    </svg>
    <span>{{ error() }}</span>
    <button class="btn-retry" (click)="retryLoad.emit()">Reintentar</button>
  </div>
</div>
} @else if (isEmpty()) {
<div class="empty-state">
  <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
    <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="#9ca3af" stroke-width="2" />
    <line x1="16" y1="2" x2="16" y2="6" stroke="#9ca3af" stroke-width="2" />
    <line x1="8" y1="2" x2="8" y2="6" stroke="#9ca3af" stroke-width="2" />
    <line x1="3" y1="10" x2="21" y2="10" stroke="#9ca3af" stroke-width="2" />
  </svg>
  <h3>No hay productos disponibles</h3>
  <p>Comience agregando un nuevo producto financiero</p>
</div>
} @else {
<div class="table-container">
  <div class="table-wrapper">
    <table class="products-table">
      <thead>
        <tr>
          <th>Logo</th>
          <th>Nombre del producto</th>
          <th>Descripción <app-tooltip text="Descripción del producto financiero" /></th>
          <th>Fecha de liberación <app-tooltip text="Fecha de lanzamiento del producto al mercado" /></th>
          <th>Fecha de revisión <app-tooltip text="Fecha de reestructuración del producto" /></th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        @for (product of products(); track product.id) {
        <tr>
          <td data-label="Logo">
            <div class="logo-container">
              <img
                [src]="product.logo"
                [alt]="product.name"
                class="product-logo"
                (error)="onImageError($event)"
              />
            </div>
          </td>
          <td data-label="Nombre">{{ product.name }}</td>
          <td data-label="Descripción">{{ product.description }}</td>
          <td data-label="F. liberación">{{ formatDate(product.date_release) }}</td>
          <td data-label="F. revisión">{{ formatDate(product.date_revision) }}</td>
          <td>
            <div class="dropdown-container">
              <button class="dropdown-button" (click)="toggleDropdown(product.id)">
                <svg width="4" height="16" viewBox="0 0 4 16">
                  <circle cx="2" cy="2" r="2" fill="#6b7280" />
                  <circle cx="2" cy="8" r="2" fill="#6b7280" />
                  <circle cx="2" cy="14" r="2" fill="#6b7280" />
                </svg>
              </button>

              <div
                class="dropdown-menu"
                [class.show]="openDropdownId() === product.id"
                (click)="$event.stopPropagation()"
              >
                <button class="dropdown-item" (click)="onEdit(product)">Editar</button>
                <button class="dropdown-item delete" (click)="onDelete(product)">Eliminar</button>
              </div>
            </div>
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>

  <div class="table-footer">
    <div class="table-separator"></div>
    <div class="table-footer-content">
      <span class="results-count">{{ productsCount() }} Resultados</span>
      <select class="page-size-select" (change)="onPageSizeChanged($event)" [value]="pageSize()">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
      </select>
    </div>
  </div>
</div>
}

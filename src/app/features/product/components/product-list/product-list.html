<div class="product-list-container">
  <!-- Header -->
  <app-header />

  <!-- Main Content -->
  <main class="main-content">
    <!-- Search Bar -->
    <div class="search-container">
      <app-search-bar
        [initialValue]="searchTerm()"
        (searchChange)="onSearch($event)"
        [placeholder]="'Buscar productos...'"
      ></app-search-bar>
    </div>

    <!-- Products Table -->
    @if (!loading() && !error()) {
    <div class="table-container">
      <table class="products-table">
        <thead>
          <tr>
            <th>Logo</th>
            <th>
              Nombre del producto
              <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="#6b7280" />
                <line x1="12" y1="16" x2="12" y2="12" stroke="white" stroke-width="2" />
                <circle cx="12" cy="8" r="1" fill="white" />
              </svg>
            </th>
            <th>
              Descripción
              <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="#6b7280" />
                <line x1="12" y1="16" x2="12" y2="12" stroke="white" stroke-width="2" />
                <circle cx="12" cy="8" r="1" fill="white" />
              </svg>
            </th>
            <th>
              Fecha de liberación
              <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="#6b7280" />
                <line x1="12" y1="16" x2="12" y2="12" stroke="white" stroke-width="2" />
                <circle cx="12" cy="8" r="1" fill="white" />
              </svg>
            </th>
            <th>
              Fecha de reestructuración
              <svg class="info-icon" width="16" height="16" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="#6b7280" />
                <line x1="12" y1="16" x2="12" y2="12" stroke="white" stroke-width="2" />
                <circle cx="12" cy="8" r="1" fill="white" />
              </svg>
            </th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          @for (product of products(); track product.id) {
          <tr>
            <td>
              <div class="logo-container">
                <img
                  [src]="product.logo"
                  [alt]="product.name"
                  class="product-logo"
                  (error)="onImageError($event)"
                />
              </div>
            </td>
            <td>{{ product.name }}</td>
            <td>{{ product.description }}</td>
            <td>{{ formatDate(product.date_release) }}</td>
            <td>{{ formatDate(product.date_revision) }}</td>
            <td>
              <div class="dropdown-container">
                <button class="dropdown-button" (click)="toggleDropdown(product.id)">
                  <svg width="4" height="16" viewBox="0 0 4 16">
                    <circle cx="2" cy="2" r="2" fill="#6b7280" />
                    <circle cx="2" cy="8" r="2" fill="#6b7280" />
                    <circle cx="2" cy="14" r="2" fill="#6b7280" />
                  </svg>
                </button>

                <div
                  class="dropdown-menu"
                  [class.show]="openDropdownId === product.id"
                  (click)="$event.stopPropagation()"
                >
                  <button class="dropdown-item" (click)="onEditProduct(product)">Editar</button>
                  <button class="dropdown-item delete" (click)="onDeleteProduct(product)">
                    Eliminar
                  </button>
                </div>
              </div>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    }

    <!-- Results Info -->
    @if (!loading() && !error()) {
    <div class="results-info">
      <span>{{ productsCount() }} Resultados</span>
      <select class="page-size-select" (change)="onPageSizeChange($event)" [value]="pageSize()">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
      </select>
    </div>
    }

    <!-- Loading State -->
    @if (loading()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p>Cargando productos...</p>
    </div>
    }

    <!-- Error State -->
    @if (error()) {
    <div class="error-container">
      <div class="error-message">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2" />
          <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2" />
          <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2" />
        </svg>
        <span>{{ error() }}</span>
        <button class="btn-retry" (click)="clearError()">Reintentar</button>
      </div>
    </div>
    }

    <!-- Empty State -->
    @if (isEmpty()) {
    <div class="empty-state">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" stroke="#9ca3af" stroke-width="2" />
        <line x1="16" y1="2" x2="16" y2="6" stroke="#9ca3af" stroke-width="2" />
        <line x1="8" y1="2" x2="8" y2="6" stroke="#9ca3af" stroke-width="2" />
        <line x1="3" y1="10" x2="21" y2="10" stroke="#9ca3af" stroke-width="2" />
      </svg>
      <h3>No hay productos disponibles</h3>
    </div>
    }
  </main>

  <!-- Delete Confirmation Modal -->
  <app-modal [show]="showDeleteModal()" (close)="cancelDelete()">
    <div modal-body>
      <p class="modal-message">
        ¿Estas seguro de eliminar el producto {{ productToDelete?.name }}?
      </p>
    </div>
    <div modal-actions class="modal-actions">
      <button class="btn-cancel" (click)="cancelDelete()">Cancelar</button>
      <button class="btn-confirm" (click)="confirmDelete()">Confirmar</button>
    </div>
  </app-modal>
</div>
